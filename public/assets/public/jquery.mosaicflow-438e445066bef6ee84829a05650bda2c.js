!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){"use strict";function i(t,i){this.container=t,this.options=i,this.container.trigger("start"),this.init(),this.container.trigger("ready")}function s(t){function i(t,i){return i.toUpper()}var s={},e=t.data();for(var n in e)s[n.replace(/-(\w)/g,i)]=e[n];return s}function e(t){var i={};if(i.height=parseInt(t.attr("height"),10),i.width=parseInt(t.attr("width"),10),0===i.height||0===i.width){var s=new Image;s.src=t.attr("src"),i.width=s.width,i.height=s.height}return i}var n=0;t.fn.mosaicflow=function(e){var n=Array.prototype.slice.call(arguments,0);return this.each(function(){var o=t(this),h=o.data("mosaicflow");h?"string"==typeof e&&h[e](n[1]):(e=t.extend({},t.fn.mosaicflow.defaults,e,s(o)),h=new i(o,e),o.data("mosaicflow",h))})},t.fn.mosaicflow.defaults={itemSelector:"> *",columnClass:"mosaicflow__column",minItemWidth:240,itemHeightCalculation:"auto"},i.prototype={init:function(){this.__uid=n++,this.__uidItemCounter=0,this.items=this.container.find(this.options.itemSelector),this.columns=t([]),this.columnsHeights=[],this.itemsHeights={},this.tempContainer=t("<div>").css({visibility:"hidden",width:"100%"}),this.workOnTemp=!1,this.autoCalculation="auto"===this.options.itemHeightCalculation,this.container.append(this.tempContainer);var i=this;this.items.each(function(){var s=t(this),e=s.attr("id");e||(e=i.generateUniqueId(),s.attr("id",e))}),this.container.css("visibility","hidden"),this.autoCalculation?t(window).load(t.proxy(this.refill,this)):this.refill(),t(window).resize(t.proxy(this.refill,this))},refill:function(){this.container.trigger("fill"),this.numberOfColumns=Math.floor(this.container.width()/this.options.minItemWidth),this.numberOfColumns<1&&(this.numberOfColumns=1);var t=this.ensureColumns();t&&(this.fillColumns(),this.columns.filter(":hidden").remove()),this.container.css("visibility","visible"),this.container.trigger("filled")},ensureColumns:function(){var i=this.columns.length,s=this.numberOfColumns;if(this.workingContainer=0===i?this.tempContainer:this.container,s>i)for(var e=s-i,n=0;e>n;n++){var o=t("<div>",{"class":this.options.columnClass});this.workingContainer.append(o)}else if(i>s){for(var h=i;h>=s;)this.columns.eq(h).hide(),h--;var r=i-s;this.columnsHeights.splice(this.columnsHeights.length-r,r)}return s!==i?(this.columns=this.workingContainer.find("."+this.options.columnClass),this.columns.css("width",100/s+"%"),!0):!1},fillColumns:function(){for(var t=this.numberOfColumns,i=this.items.length,s=0;t>s;s++){var e=this.columns.eq(s);this.columnsHeights[s]=0;for(var n=s;i>n;n+=t){var o=this.items.eq(n),h=0;e.append(o),h=this.autoCalculation?o.outerHeight():parseInt(o.find("img").attr("height"),10),this.itemsHeights[o.attr("id")]=h,this.columnsHeights[s]+=h}}this.levelBottomEdge(this.itemsHeights,this.columnsHeights),this.workingContainer===this.tempContainer&&this.container.append(this.tempContainer.children()),this.container.trigger("mosaicflow-layout")},levelBottomEdge:function(i,s){for(;;){var e=t.inArray(Math.min.apply(null,s),s),n=t.inArray(Math.max.apply(null,s),s);if(e===n)return;var o=this.columns.eq(n).children().last(),h=i[o.attr("id")],r=s[e],a=s[n],l=r+h;if(l>=a)return;this.columns.eq(e).append(o),s[n]-=h,s[e]+=h}},add:function(i){this.container.trigger("add");var s=t.inArray(Math.min.apply(null,this.columnsHeights),this.columnsHeights),n=0;if(this.autoCalculation){i.css({position:"static",visibility:"hidden",display:"block"}).appendTo(this.columns.eq(s)),n=i.outerHeight();var o=i.find("img");0!==o.length&&o.each(function(){var i=t(this),s=e(i),o=i.width()*s.height/s.width;n+=o}),i.detach().css({position:"static",visibility:"visible"})}else n=parseInt(i.find("img").attr("height"),10);i.attr("id")||i.attr("id",this.generateUniqueId());var h=this.items.toArray();h.push(i),this.items=t(h),this.itemsHeights[i.attr("id")]=n,this.columnsHeights[s]+=n,this.columns.eq(s).append(i),this.levelBottomEdge(this.itemsHeights,this.columnsHeights),this.container.trigger("mosaicflow-layout"),this.container.trigger("added")},remove:function(t){this.container.trigger("remove");var i=t.parents("."+this.options.columnClass);this.columnsHeights[i.index()-1]-=this.itemsHeights[t.attr("id")],t.detach(),this.items=this.items.not(t),this.levelBottomEdge(this.itemsHeights,this.columnsHeights),this.container.trigger("mosaicflow-layout"),this.container.trigger("removed")},empty:function(){var i=this.numberOfColumns;this.items=t([]),this.itemsHeights={};for(var s=0;i>s;s++){var e=this.columns.eq(s);this.columnsHeights[s]=0,e.empty()}this.container.trigger("mosaicflow-layout")},recomputeHeights:function(){function i(i,e){e=t(e);var o=0;o=s.autoCalculation?e.outerHeight():parseInt(e.find("img").attr("height"),10),s.itemsHeights[e.attr("id")]=o,s.columnsHeights[n]+=o}for(var s=this,e=this.numberOfColumns,n=0;e>n;n++){var o=this.columns.eq(n);this.columnsHeights[n]=0,o.children().each(i)}},generateUniqueId:function(){return this.__uidItemCounter++,"mosaic-"+this.__uid+"-itemid-"+this.__uidItemCounter}},t(function(){t(".mosaicflow").mosaicflow()})});